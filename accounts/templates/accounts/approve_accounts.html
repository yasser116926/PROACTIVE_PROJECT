<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Account Approvals</title>

    <style>
      body {
        background: #0b3c7d; /* EXACT dark blue */
        font-family: Arial, sans-serif;
        color: white;
        padding: 40px;
      }

      h2 {
        text-align: center;
        margin-bottom: 30px;
      }

      .card {
        background: rgba(255, 255, 255, 0.12);
        backdrop-filter: blur(14px);
        border-radius: 16px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
      }

      .username {
        font-size: 18px;
        font-weight: bold;
        cursor: pointer;
        display: inline-block;
      }

      .email {
        font-size: 13px;
        opacity: 0.7;
        margin-bottom: 10px;
      }

      label {
        display: block;
        margin-top: 12px;
        font-size: 14px;
        opacity: 0.85;
      }

      select,
      input {
        width: 100%;
        padding: 10px;
        border-radius: 8px;
        border: none;
        margin-top: 5px;
        background: rgba(255, 255, 255, 0.2);
        color: white;
      }

      select option {
        background: #fff;
        color: #000;
      }

      button {
        margin-top: 18px;
        width: 100%;
        padding: 12px;
        border-radius: 10px;
        border: none;
        background: #f4c430;
        font-weight: bold;
        cursor: pointer;
      }

      .student-only {
        margin-top: 10px;
        opacity: 0.8;
        font-size: 13px;
      }

      .view-active-btn {
        padding: 10px 18px;
        background: #f4c430;
        color: black;
        font-weight: bold;
        border-radius: 8px;
        text-decoration: none;
        float: right;
        margin-bottom: 25px;
      }
    </style>
  </head>

  <body>
    <h2>Pending Account Approvals</h2>

    <a href="{% url 'accounts:active_accounts' %}" class="view-active-btn">
      View Active Accounts
    </a>

    {% for user in pending_users %}
    <div class="card">
      <!-- CLICKABLE NAME -->
      <div class="username" onclick="toggleForm('form-{{ user.id }}')">
        {{ user.username }}
      </div>

      <div class="email">{{ user.email }}</div>

      <form method="post" id="form-{{ user.id }}" style="display: none">
        {% csrf_token %}
        <input type="hidden" name="user_id" value="{{ user.id }}" />

        <label>Profession</label>
        <select name="profession" onchange="handleProfession(this)" required>
          <option value="">Select</option>
          <option value="management">Management</option>
          <option value="staff">Staff</option>
          <option value="instructor">Instructor</option>
          <option value="student pilot">Student Pilot</option>
        </select>

        <label>Role / Specialization</label>
        <select name="specialization" required>
          <option value="">Select</option>
          <option value="administrator">Administrator</option>
          <option value="accountant">Accountant</option>
          <option value="chief">Chief</option>
          <option value="reception">Reception</option>
          <option value="dispatch">Flight Dispatch</option>
          <option value="technician">Technician</option>
          <option value="ppl">PPL</option>
          <option value="cpl">CPL</option>
          <option value="atpl">ATPL</option>
          <option value="ir">Multi / IR</option>
          <option value="conversion">License Conversion</option>
        </select>

        <!-- STUDENT INFO (AUTO) -->
        <div
          class="student-only"
          style="display: none"
          id="student-box-{{ user.id }}"
        >
          <strong>Student Number:</strong>
          <span id="student-number-{{ user.id }}"></span>
        </div>

        <button type="submit">Approve Account</button>
      </form>
    </div>
    {% empty %}
    <p style="text-align: center; opacity: 0.7">No pending accounts</p>
    {% endfor %}

    <script>
      function toggleForm(id) {
        const form = document.getElementById(id);
        if (!form) return;

        form.style.display = form.style.display === "none" ? "block" : "none";
      }

      function handleProfession(select) {
        const form = select.closest("form");
        if (!form) return;

        const userId = form.querySelector("input[name='user_id']").value;

        const studentBox = document.getElementById(`student-box-${userId}`);

        const studentNumberSpan = document.getElementById(
          `student-number-${userId}`
        );

        if (select.value === "student pilot") {
          studentBox.style.display = "block";

          // generate preview number (UI only)
          const preview = "PR" + Math.floor(100000 + Math.random() * 900000);

          studentNumberSpan.innerText = preview;
        } else {
          studentBox.style.display = "none";
          studentNumberSpan.innerText = "";
        }
      }
    </script>
  </body>
</html>
