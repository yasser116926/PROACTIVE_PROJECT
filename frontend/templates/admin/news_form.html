<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Add News</title>
    <link rel="stylesheet" href="../assets/style.css" />
  </head>
  <body>
    <h1>Add News</h1>

    <form id="news-form">
      <label>Title:</label><br />
      <input type="text" id="title" required /><br /><br />

      <label>Description:</label><br />
      <textarea id="description" rows="5" required></textarea><br /><br />

      <button type="submit">Add News</button>
    </form>

    <p id="result"></p>

    <script src="../assets/auth.js"></script>
    <script>
      const form = document.getElementById("news-form");
      const result = document.getElementById("result");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        try {
          // Make sure admin is logged in
          if (!TOKEN) await login("admin", "yourpassword");

          const response = await fetch("http://127.0.0.1:8000/api/news/", {
            method: "POST",
            headers: {
              ...authHeaders(),
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              title: document.getElementById("title").value,
              description: document.getElementById("description").value,
            }),
          });

          if (response.ok) {
            result.style.color = "green";
            result.innerText = "News added successfully!";
            form.reset();
          } else {
            const err = await response.json();
            result.style.color = "red";
            result.innerText = JSON.stringify(err);
          }
        } catch (err) {
          result.style.color = "red";
          result.innerText = "Error adding news";
          console.error(err);
        }
      });
    </script>
  </body>
</html>
